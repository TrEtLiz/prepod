# Лекция 8: Вероятность в игровом дизайне и основы компьютерной логики

## Введение: Вероятность как кровь игры

Вероятность — это фундаментальный инструмент, который превращает предсказуемую последовательность действий в увлекательное приключение. Без вероятности игра становится детерминированной машиной, где каждое действие имеет однозначный результат. Вероятность вводит элемент **непредсказуемости**, которая делает игру интересной, напряжённой и переигрываемой.

В контексте игровой механики вероятность работает не в вакууме — она тесно взаимодействует с навыками игрока, его решениями и восприятием справедливости. Хороший геймдизайнер должен понимать, что вероятность — это не просто математический инструмент, а средство коммуникации с игроком.

---

## Часть 1: Теоретические основы вероятности

### 1.1 Базовые понятия

**Вероятность** — это числовая оценка возможности наступления события, выражающаяся числом от $0$ до $1$ или от $0\%$ до $100\%$.

**Формула классической вероятности:**

$$P(A) = \frac{n}{N}$$

Где:
- $P(A)$ — вероятность события A
- $n$ — количество благоприятных исходов
- $N$ — общее количество возможных исходов

**Пример 1:** Вытягивание красной карты из стандартной колоды ($52$ карты)
- Красных карт: $26$ ($13$ червей + $13$ бубнов)
- Всего карт: $52$

$$P(\text{красная карта}) = \frac{26}{52} = \frac{1}{2} = 0,5 = 50\%$$

### 1.2 Представление вероятности

Вероятность можно выразить тремя способами:

| Формат | Значение | Пример |
|--------|----------|---------|
| Дробь | $\frac{1}{4}$ | Вероятность выпадения $6$ на кубике: $\frac{1}{6}$ |
| Десятичная дробь | $0,25$ | $0,5 = 50\%$ |
| Процент | $25\%$ | $12,5\% = \frac{1}{8}$ |

**Интервалы:**
- От $0$ до $1$ (где $1 = 100\%$ вероятность)
- От $0\%$ до $100\%$

### 1.3 Противоположные события

Если вероятность события $A$ равна $P(A)$, то вероятность того, что событие $A$ не произойдёт:

$$P(\neg A) = 1 - P(A)$$

**Пример 2:** Вероятность промаха лучника
- Если вероятность попадания: $P(\text{попадание}) = 0,7 = 70\%$
- То вероятность промаха: $P(\text{промах}) = 1 - 0,7 = 0,3 = 30\%$

**Пример 3:** Бросок кубика
- Вероятность выпадения $6$: $P(6) = \frac{1}{6} \approx 16,67\%$
- Вероятность того, что выпадет НЕ $6$: $P(\neg 6) = 1 - \frac{1}{6} = \frac{5}{6} \approx 83,33\%$

---

## Часть 2: Операции с вероятностями

### 2.1 Сложение вероятностей (логический "ИЛИ")

Когда один исход **исключает** другой, мы **складываем** вероятности.

**Формула:**

$$P(A \text{ или } B) = P(A) + P(B)$$

Эта формула работает для **несовместных событий** (когда они не могут происходить одновременно).

**Пример 4:** Вероятность вытянуть туза ИЛИ короля из колоды

В колоде $52$ карты:
- Тузов: $4$
- Королей: $4$
- Туза и короля одновременно быть не может (несовместные события)

$$P(\text{туз или король}) = \frac{4}{52} + \frac{4}{52} = \frac{8}{52} = \frac{2}{13} \approx 15,38\%$$

**Пример 5:** Критический удар в RPG
- Вероятность критического удара мечом: $15\%$
- Вероятность критического удара магией: $10\%$
- Оба события не могут произойти в один момент

$$P(\text{крит}) = 0,15 + 0,10 = 0,25 = 25\%$$

**Пример 6:** Получение негативного статуса в боевой системе
- Вероятность отравления: $12\%$
- Вероятность ожога: $8\%$
- Вероятность оледенения: $5\%$

$$P(\text{негативный статус}) = 0,12 + 0,08 + 0,05 = 0,25 = 25\%$$

### 2.2 Умножение вероятностей (логический "И")

Когда один исход **не влияет** на другой, мы **умножаем** вероятности.

**Формула:**

$$P(A \text{ и } B) = P(A) \times P(B)$$

Эта формула работает для **независимых событий** (когда результат одного события не влияет на результат другого).

**Пример 7:** Вероятность выпадения двух четных чисел при броске двух кубиков

Первый кубик: четные числа — $\{2, 4, 6\}$
- $P(\text{четное на первом}) = \frac{3}{6} = 0,5$

Второй кубик: четные числа — $\{2, 4, 6\}$
- $P(\text{четное на втором}) = \frac{3}{6} = 0,5$

$$P(\text{оба четные}) = 0,5 \times 0,5 = 0,25 = 25\%$$

**Пример 8:** Два последовательных попадания в цель

Если вероятность попадания лучника = $80\%$:

$$P(\text{две подряд}) = 0,8 \times 0,8 = 0,64 = 64\%$$

**Пример 9:** Получение двух баффов из лут-сундука

- Вероятность получить бафф здоровья: $30\%$
- Вероятность получить бафф силы: $40\%$
- Эти события независимы (один лут-сундук)

$$P(\text{оба баффа}) = 0,3 \times 0,4 = 0,12 = 12\%$$

**Пример 10:** Цепочка случайных событий в подземелье

Требуется успешно пройти три проверки:
- Проверка на замечание врагов: $75\%$
- Проверка на ловкость при прыжке: $70\%$
- Проверка на удачу при открытии сундука: $60\%$

$$P(\text{все три успеха}) = 0,75 \times 0,7 \times 0,6 = 0,315 = 31,5\%$$

---

## Часть 3: Нелинейные распределения вероятности

### 3.1 От линейного к нелинейному

Когда мы складываем несколько независимых случайных исходов, результат становится **нелинейным**. Это означает, что не все результаты равновероятны.

**Критическое понимание:** Казалось бы, что при броске двух кубиков каждое число от $2$ до $12$ должно иметь вероятность $\frac{1}{11} \approx 9,09\%$. На самом деле это не так!

### 3.2 Таблица сумм при броске двух кубиков

| Кубик 1 \ Кубик 2 | 1 | 2 | 3 | 4 | 5 | 6 |
|---|---|---|---|---|---|---|
| **1** | 2 | 3 | 4 | 5 | 6 | **7** |
| **2** | 3 | 4 | 5 | **6** | **7** | **8** |
| **3** | 4 | 5 | **6** | **7** | **8** | 9 |
| **4** | 5 | **6** | **7** | **8** | 9 | 10 |
| **5** | **6** | **7** | **8** | 9 | 10 | 11 |
| **6** | **7** | **8** | 9 | 10 | 11 | 12 |

**Анализ результатов:**

$$P(\text{сумма} = n) = \frac{\text{количество комбинаций}}{36}$$

- $P(2) = \frac{1}{36} \approx 2,78\%$ (только $1+1$)
- $P(3) = \frac{2}{36} \approx 5,56\%$ ($1+2$, $2+1$)
- $P(6) = \frac{5}{36} \approx 13,89\%$ ($1+5$, $2+4$, $3+3$, $4+2$, $5+1$)
- $P(7) = \frac{6}{36} = \frac{1}{6} \approx 16,67\%$ (самая вероятная!) ($1+6$, $2+5$, $3+4$, $4+3$, $5+2$, $6+1$)
- $P(12) = \frac{1}{36} \approx 2,78\%$ (только $6+6$)

**Вывод:** $7$ выпадает в **$6$ раз** чаще, чем $2$ или $12$!

### 3.3 Применение в игровом дизайне

Нелинейное распределение критически важно при проектировании систем лута, урона и наград.

**Пример 11:** Система урона в файтере с двумя источниками

Предположим, урон зависит от двух факторов:
- Базовая атака ($1-5$ урона)
- Дополнительный бонус ($1-5$ урона)

Общий урон: $2-10$

Распределение не равномерно! Урон в $6$ единиц будет выпадать чаще, чем $2$ или $10$.

**Пример 12:** Система критического урона в RPG

- Первый кубик ($d6$): определяет, происходит ли крит (выпадает $6$)
- Второй кубик ($d6$): определяет множитель урона

Благодаря нелинейности, средний крит будет скорее $2-3x$, чем $5-6x$.

---

## Часть 4: Теоретическая vs. Практическая вероятность

### 4.1 Закон больших чисел

**Теоретическая вероятность** — это идеальное математическое значение.

**Практическая (эмпирическая) вероятность** — это результат, полученный в реальных испытаниях:

$$P_{\text{практ}} = \frac{\text{количество успехов}}{{\text{общее количество испытаний}}}$$

**Закон больших чисел гласит:** Чем больше испытаний, тем ближе практическая вероятность к теоретической.

### 4.2 Примеры сходимости

**Пример 13:** Бросок монеты

Теоретическая вероятность орла: $50\%$

| Количество бросков | Орлы | Решки | % орлов |
|---|---|---|---|
| $10$ | $6$ | $4$ | $60\%$ |
| $100$ | $48$ | $52$ | $48\%$ |
| $1000$ | $510$ | $490$ | $51\%$ |
| $10000$ | $5012$ | $4988$ | $50,12\%$ |

С каждым увеличением испытаний, результат приближается к идеальным $50\%$.

**Пример 14:** Проверка баланса дроп-рейта в игре

Вероятность получить легендарный предмет должна быть $5\%$.

- После $100$ боев: получено $3$ легенды ($3\%$)
- После $1000$ боев: получено $42$ легенды ($4,2\%$)
- После $10000$ боев: получено $501$ легенда ($5,01\%$)

Как видим, чем больше игроки играют, тем ближе результаты к ожидаемым $5\%$.

### 4.3 Почему это важно для разработчика

Игроков часто обманывает **малое количество данных**. После нескольких неудачных попыток они говорят "рейт кривой", но статистически это нормально. Разработчикам нужно:

1. Собирать больше данных перед балансировкой
2. Информировать игроков о вероятностях (прозрачность)
3. Понимать разницу между "не повезло" и "поломано"

---

## Часть 5: Ожидаемое значение (Expected Value)

### 5.1 Определение и формула

**Ожидаемое значение** — это средний результат, который мы получим при многократном повторении случайного события.

**Формула:**

$$E[X] = \sum_{i=1}^{n} x_i \cdot P(x_i)$$

Где:
- $E[X]$ — ожидаемое значение
- $x_i$ — значение $i$-го исхода
- $P(x_i)$ — вероятность $i$-го исхода
- $\sum$ — сумма по всем исходам

### 5.2 Примеры расчета

**Пример 15:** Бросок стандартного кубика

$$E[d6] = 1 \cdot \frac{1}{6} + 2 \cdot \frac{1}{6} + 3 \cdot \frac{1}{6} + 4 \cdot \frac{1}{6} + 5 \cdot \frac{1}{6} + 6 \cdot \frac{1}{6}$$

$$E[d6] = \frac{1+2+3+4+5+6}{6} = \frac{21}{6} = 3,5$$

Значит, при многократных бросках среднее значение будет около $3,5$.

**Пример 16:** Система вознаграждений в квесте

Вам даётся выбор:

- Вариант A: Получить $100$ золота (вероятность $100\%$)
- Вариант B: Получить $250$ золота (вероятность $40\%$) или $0$ золота (вероятность $60\%$)

Ожидаемое значение варианта A:
$$E[A] = 100 \cdot 1 = 100 \text{ золота}$$

Ожидаемое значение варианта B:
$$E[B] = 250 \cdot 0,4 + 0 \cdot 0,6 = 100 \text{ золота}$$

Оба варианта имеют одинаковое ожидаемое значение! Но психологически игрок может предпочесть один из них.

**Пример 17:** Открытие сундука с добычей

Содержимое сундука:
- $50$ золота ($50\%$ вероятность)
- $100$ золота ($30\%$ вероятность)
- $500$ золота ($15\%$ вероятность)
- Легендарный меч ($5\%$ вероятность, оценим в $1000$ золота эквивалентом)

$$E[\text{сундук}] = 50 \cdot 0,5 + 100 \cdot 0,3 + 500 \cdot 0,15 + 1000 \cdot 0,05$$

$$E[\text{сундук}] = 25 + 30 + 75 + 50 = 180 \text{ условных единиц}$$

Каждый открытый сундук в среднем даёт примерно $180$ единиц ценности.

### 5.3 Субъективные значения

При расчете ожидаемого значения нужно учитывать не только объективные показатели, но и **субъективную ценность** для игрока.

**Пример 18:** Лут в зависимости от класса персонажа

- Огненный меч: 100 золота (объективная ценность), но 200 золота для мага (субъективная ценность)
- Ледяной посох: 100 золота (объективная ценность), но 500 золота для мага (субъективная ценность)

Для лутовой системы нужно учитывать, что при вычислении ожидаемого значения награды, ценность предметов разная в зависимости от класса персонажа.

**Пример 19:** Психология малых вероятностей

Исследования показывают, что люди переоценивают малые вероятности:
- Событие с вероятностью 1% кажется более вероятным, чем оно есть
- События с вероятностью 99% кажутся более гарантированными, чем оно есть

Это нужно учитывать при дизайне рейтов:
- Шанс "5% получить легендарный предмет" кажется привлекательнее, чем на самом деле
- Шанс "99% получить обычный предмет" кажется менее гарантированным

**Пример 20:** Таблица вероятностей в лут-системе

| Редкость | Объективная вероятность | Воспринимаемая вероятность | Субъективная ценность |
|---|---|---|---|
| Обычный предмет | 85% | 90% | Низкая |
| Редкий | 12% | 8% | Средняя |
| Эпический | 2,5% | 1% | Высокая |
| Легендарный | 0,5% | 0,2% | Очень высокая |

Люди воспринимают редкие события как менее частые, чем они есть. Это увеличивает субъективную ценность редких предметов.

---

## Часть 6: Взаимосвязь навыков и вероятности

### 6.1 Две стороны одной медали

В правильно спроектированной игре **навыки и вероятность** работают как две стороны одной медали:

1. **Чистая вероятность** — случайность, на которую игрок не может влиять
2. **Вероятность, зависимая от навыка** — случайность, которую игрок может контролировать через умение

### 6.2 Компоненты успеха

**Формула успеха в игре:**

$$\text{Успех} = \text{Навык игрока} + \text{Навыки персонажа} + \text{Случайность} + \text{Решения}$$

**Пример 21:** Попадание в стратегической игре

- Базовая точность оружия: 70%
- Модификатор навыка стрельбы игрока: +10%
- Модификатор высоты/расстояния: ±5%
- Случайный разброс: ±2%

Финальная вероятность попадания = 70% + 10% - 5% ± 2% = 73-77%

### 6.3 Четыре ключевых принципа

**Принцип 1: Прозрачность понимания**

Игроки должны интуитивно понимать, что происходит в игре. Если они видят, что лучник делает успешные выстрелы, они должны понимать, почему это произошло (высокий навык? удача? хорошее оружие?).

**Пример 22:** Хороший геймплей для лучника
- Визуальная обратная связь: линия прицела показывает точку попадания
- Звуковые эффекты: разные звуки для попаданий и промахов
- Числовые значения: показываются проценты точности

**Принцип 2: Вероятность успеха навыка**

Каждый навык персонажа имеет встроенную вероятность успеха. Это не просто детерминированное действие.

**Пример 23:** Система оледенения в ролевой игре

- Заклинание "Ледяной шар" имеет базовый шанс оледенения 40%
- Навык персонажа "Мастер заморозки" увеличивает это на +20% (итого 60%)
- Враг может иметь сопротивление холоду -15% (итого 45%)
- Финальная вероятность = 45%

**Принцип 3: Оценка риска — это навык**

Хороший игрок учится оценивать вероятности и принимать обоснованные решения. Это отличает опытного игрока от новичка.

**Пример 24:** Позиционирование в тактической игре

Новичок видит врага и атакует (50% вероятность попадания, 30% вероятность контратаки, 20% вероятность получить урон).

Опытный игрок:
1. Вычисляет, что атака имеет 50% шанс попадания
2. Видит, что враг получит 30% шанс контратаки
3. Подсчитывает, что ожидаемый урон = $0,5 \times 30 = 15$% вероятность получить урон
4. Понимает, что выгоднее переместиться на возвышенность (+20% точность)

**Принцип 4: Предсказание чистой случайности — иллюзия**

Нельзя предсказать чистую случайность. Если система действительно случайна, то игрок, который утверждает, что может её предсказать — либо читерит, либо ошибается.

**Пример 25:** Анализ "читерства"

Если в системе рандомных лутбоксов:
- Вероятность легендарного предмета = 1%
- После 100 открытий игрок получил 0 легенд

Это не означает, что система поломана! При вероятности 1%, вероятность получить ноль легенд из 100 попыток:

$$P(\text{ноль}) = (1-0,01)^{100} = 0,99^{100} \approx 36,6\%$$

Это довольно вероятный исход! Это не читерство, это нормальная дисперсия.

### 6.4 Баланс между риском и случайностью

Риск и случайность — это как специи в кулинарии. Небольшое количество делает блюдо вкусным, но слишком много портит всё.

**Слишком мало вероятности:**
- Игра становится скучной и предсказуемой
- Результат зависит только от механики, не от решений
- Игроки знают точный исход перед началом

**Слишком много вероятности:**
- Навыки становятся бесполезными
- Игрок чувствует, что результат не зависит от него
- "Я проиграл из-за невезения, а не потому что плохо играю"

**Золотая середина:**
- 30-50% успеха зависит от навыков
- 20-40% успеха зависит от случайности
- 20-30% успеха зависит от решений и стратегии

---

## Часть 7: Компьютерная логика и вероятность

### 7.1 Основы компьютерной логики

**Компьютерная логика** — это система правил, которые компьютер использует для принятия решений. В контексте игр это воплощается через:

1. **Булева логика** — операции TRUE/FALSE
2. **Условные операторы** — IF/THEN/ELSE
3. **Циклы** — WHILE/FOR
4. **Логические операции** — AND/OR/NOT

### 7.2 Булева логика в играх

**Базовые логические операции:**

| Операция | Символ | Значение | Пример |
|---|---|---|---|
| AND (И) | && | Оба условия TRUE | `(враг_видит_игрока) && (враг_боится)` → атаковать |
| OR (ИЛИ) | \|\| | Хотя бы одно TRUE | `(здоровье < 20%) \|\| (боеприпасы == 0)` → отступить |
| NOT (НЕ) | ! | Инверсия | `!(игрок_в_защите)` → враг получает +20% урона |

### 7.3 Условные операторы и вероятность

**Пример 26:** Базовая система защиты

```
IF (игрок.позиция == защита) THEN
    входящий_урон = входящий_урон * 0.5  // 50% урона
ELSE
    входящий_урон = входящий_урон        // 100% урона
END IF
```

**Пример 27:** Система уклонения с вероятностью

```
случайное_число = RANDOM(0, 100)  // От 0 до 100
IF (случайное_число <= вероятность_уклонения) THEN
    // Успешное уклонение
    урон = 0
ELSE
    // Промах уклонения
    урон = входящий_урон
END IF
```

### 7.4 Циклы и итеративные вероятности

**Пример 28:** Система повторных попыток

```
попыток = 0
максимум_попыток = 3
успех = FALSE

WHILE (попыток < максимум_попыток) AND (успех == FALSE) DO
    случайное_число = RANDOM(0, 100)
    IF (случайное_число <= 60) THEN  // 60% шанс за попытку
        успех = TRUE
    END IF
    попыток = попыток + 1
END WHILE

IF (успех == TRUE) THEN
    OUTPUT "Удалось с попытки " + попыток
ELSE
    OUTPUT "Не удалось после " + максимум_попыток + " попыток"
END IF
```

Вероятность успеха хотя бы один раз из трех попыток:

$$P(\text{успех хотя бы раз}) = 1 - P(\text{все три неудачи})$$

$$P = 1 - (0,4)^3 = 1 - 0,064 = 0,936 = 93,6\%$$

### 7.5 Вложенные условия и сложная логика

**Пример 29:** Система урона в боевой системе

```
FUNCTION рассчитать_урон(атакующий, защищающийся) DO
    базовый_урон = атакующий.сила
    
    // Проверка попадания
    IF RANDOM(0, 100) > вероятность_попадания THEN
        RETURN 0  // Промах
    END IF
    
    // Проверка критического удара
    IF RANDOM(0, 100) <= вероятность_крита THEN
        базовый_урон = базовый_урон * множитель_крита
        OUTPUT "КРИТИЧЕСКИЙ УДАР!"
    END IF
    
    // Проверка защиты
    IF защищающийся.активирована_защита THEN
        базовый_урон = базовый_урон * 0.5
    END IF
    
    // Проверка специального эффекта
    IF RANDOM(0, 100) <= шанс_оледенения THEN
        защищающийся.добавить_эффект("заморожен")
    END IF
    
    RETURN базовый_урон
END FUNCTION
```

### 7.6 Генераторы псевдослучайных чисел (PRNG)

**Проблема:** Компьютеры не умеют генерировать真實 случайные числа. Они используют **алгоритмы**, которые генерируют последовательности, похожие на случайные.

**Пример 30:** Простой алгоритм PRNG (Linear Congruential Generator)

$$X_{n+1} = (a \cdot X_n + c) \bmod m$$

Где:
- $X_n$ — текущее число
- $a, c, m$ — константы
- $\bmod$ — операция модуля (остаток от деления)

Для преобразования в вероятность:

$$P = \frac{X_n}{m}$$

# Заключение: Вероятность как язык геймдизайна

Вероятность — это не просто математический инструмент в арсенале разработчика. Это язык, на котором игра разговаривает с игроком. Через вероятность:

- Мы обучаем игроков оценивать риск
- Мы создаём ощущение справедливости
- Мы делаем игру переигрываемой и захватывающей
- Мы контролируем баланс между умением и везением

Хороший геймдизайнер понимает, что вероятность — это не случайность для случайности. Каждый процент, каждый коэффициент, каждое распределение — это осознанный выбор, который формирует опыт игрока.

**Помните:** баланс — это искусство, которое требует постоянного тестирования, анализа данных и готовности к изменениям. Не бойтесь экспериментировать, собирайте данные и слушайте сообщество. Ваша интуиция важна, но данные важнее.

Да здравствует справедливый рандом и умные вероятности!

